
<th:block th:fragment="head">

	<meta charset="UTF-8">
	<meta name="description" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport"
		content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

	<!-- Title -->
	<title>DoBuy - Lifestyle</title>

	<!-- Favicon -->
	<link rel="icon"
		th:href="@{/back-end-home/img/core-img/logo noback.png}">

	<!-- Style CSS -->
	<link rel="stylesheet" th:href="@{/back-end-home/css/style.css}">

	<!-- 套入fontawesome -->
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


	<link rel="stylesheet" th:href="@{/back-end-home/css/login.css}">

	<style>
/* 加入以下樣式來讓 Nav Area 自適應寬度 */
.original-nav-area {
	width: 100% !important;
}

.top-header {
	width: 100%;
	padding: 0 6rem; /* 配合body的邊距 */
}

.container {
	width: 100%;
	max-width: none; /* 移除固定寬度限制 */
	padding: 0 15px; /* 保持內容兩側留白 */
}

body {
	margin: 0 6rem !important;
	padding: 0 !important;
	background-color: #f8f9fa !important;
	overflow-x: hidden; /* 防止水平滾動 */
	min-width: 1200px; /* 設置最小寬度 */
}

/* 確保頁面內容與導航欄對齊 */
.blog-wrapper, .instagram-feed-area, .footer-area {
	margin: 0 -6rem; /* 抵消body的margin */
	padding: 0 6rem; /* 加回相同的padding */
}

.logo-area {
	width: 100%;
	max-width: none;
	padding: 0 6rem;
}

.original-nav-area .classy-navbar {
	width: 100%;
	max-width: none;
}
</style>

</th:block>





<th:block th:fragment="header">



	<!-- 登入及顯示管理員姓名 -->
	<div class="admin-controls">
		<div class="admin-name">
			<i class="fas fa-user-circle"></i> <span
				th:text="${session.managerName != null ? session.managerName : '管理員'}">管理員</span>
		</div>

		<form th:action="@{/logout}" method="get" style="margin: 0;">
			<button type="submit" class="logout-btn">
				<i class="fas fa-sign-out-alt"></i> 登出
			</button>
		</form>
	</div>


	<!-- ##### Header Area Start ##### -->
	<header class="header-area">

		<!-- Top Header Area -->
		<div class="top-header">
			<div class="container h-100">
				<div class="row h-100 align-items-center">
					<!-- Breaking News Area -->
					<div class="col-12 col-sm-8">
						<div class="breaking-news-area">
							<div id="breakingNewsTicker" class="ticker">
								<ul>
									<li><a th:href="@{/back-end-homepage}">Hello Staff!</a></li>
									<li><a th:href="@{/back-end-homepage}">Hello Universe!</a></li>
									<li><a th:href="@{/back-end-homepage}">Hello Earth!</a></li>
									<li><a th:href="@{/back-end-homepage}">Hello DoBuy!</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Logo Area -->
		<div class="logo-area text-center">
			<div class="container h-100">
				<div class="row h-100 align-items-center">
					<div class="col-12">
						<a th:href="@{/back-end-homepage}" class="original-logo"><img
							th:src="@{/back-end-home/img/core-img/logo noback.png}" alt=""></a>
					</div>
				</div>
			</div>
		</div>


		<!-- Nav Area -->
		<div class="original-nav-area" id="stickyNav">
			<div class="classy-nav-container breakpoint-off">
				<div class="container">
					<!-- Classy Menu -->
					<nav class="classy-navbar justify-content-between">

						<!-- Navbar Toggler -->
						<div class="classy-navbar-toggler">
							<span class="navbarToggler"><span></span><span></span><span></span></span>
						</div>

						<!-- Menu -->
						<div class="classy-menu" id="originalNav">
							<!-- close btn -->
							<div class="classycloseIcon">
								<div class="cross-wrap">
									<span class="top"></span><span class="bottom"></span>
								</div>
							</div>

							<!-- Nav Start -->
							<div class="classynav">
								<ul>
									<li><a class="dropdown-font"
										th:href="@{/back-end-homepage}">首頁</a></li>
									<li><a href="#">會員管理</a>
										<ul class="dropdown">
											<li><a href="/back-end/member">會員管理</a></li>
											<li><a href="/back-end/memberorder">會員管理訂單管理</a></li>
										</ul></li>

									<li><a href="#">櫃位系統</a>
										<ul class="dropdown">
											<li><a th:href="@{/back-end/counter}">櫃位管理專區</a></li>
											<li><a th:href="@{/monthsettlement/addMonthSettlement}">抽成月結</a></li>
										</ul></li>

									<li><a href="#">商城系統</a>
										<ul class="dropdown">
											<li><a
												th:href="@{/storecarousel/listAllStorecarouseltest}">首頁輪播圖管理</a></li>
											<li><a th:href="@{/goodstype/listAllGoodsType}">商品分類管理</a></li>
										</ul></li>

									<li><a href="#">商品審核系統</a>
										<ul class="dropdown">
											<li><a th:href="@{/goods/listAllCheckStatus}">一般商品審核</a></li>
											<li><a th:href="@{/used/listAllUsed49}" id="used-check">二手商品審核</a></li>
										</ul></li>

									<li><a href="#">管理員資料</a>
										<ul class="dropdown">
											<li><a
												th:href="@{'/manager/manager?managerNo=' + ${session.managerNo}}">管理員資料管理</a>
											</li>
										</ul></li>

									<li><a href="#">優惠管理</a>
										<ul class="dropdown">
											<li><a th:href="@{/discount/listAllDiscount}">平台優惠活動管理</a></li>
											<li><a th:href="@{/coupon/approve}">廠商優惠券管理</a></li>
										</ul></li>

									<li><a href="#">客服系統</a>
										<ul class="dropdown">
											<li><a href="#">客服訊息回覆</a></li>
										</ul></li>
								</ul>

								<!-- Search Form  -->
								<!--                                 <div id="search-wrapper"> -->
								<!--                                     <form action="#"> -->
								<!--                                         <input type="text" id="search" placeholder="Search something..."> -->
								<!--                                         <div id="close-icon"></div> -->
								<!--                                         <input class="d-none" type="submit" value=""> -->
								<!--                                     </form> -->
								<!--                                 </div> -->
							</div>
							<!-- Nav End -->
						</div>
					</nav>
				</div>
			</div>
		</div>
	</header>
</th:block>





<th:block th:fragment="footer">
	<!-- ##### Footer Area Start ##### -->
	<footer class="footer-area text-center">
		<div class="container">
			<div class="row"></div>
		</div>

		<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
		Copyright &copy;
		<script>
			document.write(new Date().getFullYear());
		</script>
		All rights reserved | <i class="fa-regular fa-heart fa-bounce"></i> by
		<a th:href="@{/back-end-homepage}" target="_blank">DOBUY</a>

	</footer>

</th:block>



<th:block th:fragment="js">
	<!-- jQuery (Necessary for All JavaScript Plugins) -->
	<script th:src="@{/back-end-home/js/jquery/jquery-2.2.4.min.js}"></script>
	<!-- Popper js -->
	<script th:src="@{/back-end-home/js/popper.min.js}"></script>
	<!-- Bootstrap js -->
	<script th:src="@{/back-end-home/js/bootstrap.min.js}"></script>
	<!-- Plugins js -->
	<script th:src="@{/back-end-home/js/plugins.js}"></script>
	<!-- Active js -->
	<script th:src="@{/back-end-home/js/active.js}"></script>


	<script>
		    function submitApproval(goodsNo) {
		        if (!goodsNo) {
		            window.location.href = '/goods/listAllCheckStatus';
		            return;
		        }
		
		        const checkStatus = 1;
		        fetch('/goods/updateCheckStatus2', {
		            method: 'POST',
		            headers: {
		                'Content-Type': 'application/x-www-form-urlencoded',
		            },
		            body: 'goodsNo=' + goodsNo + '&checkStatus=' + checkStatus
		        })
		        .then(response => {
		            if (!response.ok) {
		                throw new Error('Network response was not ok');
		            }
		            return response.text();
		        })
		        .then(result => {
		            alert(result);
		            // 可能需要重新加載頁面或更新UI
		            window.location.reload();
		        })
		        .catch(error => {
		            console.error('Error:', error);
		            alert('審核失敗：' + error.message);
		        });
		    }
		    
		   
		
		    
		  //=====================二手商品管理事件====================================
		    $(document).ready(function() {
		        // 当 span id 为 a1 的元素被点击时，触发 AJAX 事件
		        $('#used-check').click(function() {
		            // 使用AJAX从后端以POST方式获取数据
		            $.ajax({
		                url: '/used/getAllSellerUsedListFragment', // 服务器端 API，返回 Thymeleaf 片段
		                type: 'POST',
		                success: function(response) {
		                    console.log("Fragment HTML:", response); // 打印返回的 HTML，便于调试

		                    // 使用 fragment 替换 <div class="use_1">
		                    $('.usedcheckarea').html(response);
		                    initializeSlick();
		                    
		                    // 检查并销毁已有 DataTables 实例
		                    if ($.fn.DataTable.isDataTable('#UsedList')) {
		                        $('#UsedList').DataTable().destroy();
		                    }

		                 // 初始化 DataTables
		                    var table = $('#UsedList').DataTable({
		                        "lengthMenu": [3, 5, 10, 20, 50, 100],
		                        "searching": true,
		                        "paging": true,
		                        "ordering": true,
		                        "language": {
		                            "processing": "處理中...",
		                            "loadingRecords": "載入中...",
		                            "lengthMenu": "顯示 _MENU_ 筆結果",
		                            "zeroRecords": "沒有符合的結果",
		                            "info": "顯示第 _START_ 至 _END_ 筆結果，共<font color=red> _TOTAL_ </font>筆",
		                            "infoEmpty": "顯示第 0 至 0 筆結果，共 0 筆",
		                            "infoFiltered": "(從 _MAX_ 筆結果中過濾)",
		                            "paginate": {
		                                "first": "第一頁",
		                                "previous": "上一頁",
		                                "next": "下一頁",
		                                "last": "最後一頁"
		                            }
		                        }
		                    });

		                    // 初始化 Slick 特效
		                    function initializeSlick() {
							    $('.photo-slider').not('.slick-initialized').slick({
							    	dots: false, // 禁用點狀導航
							        infinite: true, // 禁用無限滾動
							        speed: 300, // 滑動速度
							        slidesToShow: 1, // 每次只顯示一張圖片
							        slidesToScroll: 1, // 每次滑動一張圖片
							        adaptiveHeight: true, // 自適應高度
							        arrows: false, // 禁用 previous 和 next 按鈕
							        centerMode: false, // 禁用居中模式
							        variableWidth: false // 禁用可變寬度，讓所有圖片固定尺寸
							        
							    });
							    
							}


		                    // 初次载入时初始化 Slick
		                    initializeSlick();

		                    // 监听 DataTables 分页切换事件，重新初始化 Slick
		                    $('#UsedList').on('draw.dt', function () {
		                        initializeSlick();
		                    });
		                },
		                error: function(xhr, status, error) {
		                    console.error('Error fetching used list data:', error);
		                }
		            });
		        });
		    });

		    //=====================二手商品管理事件====================================
		    $(document).ready(function() {
		        // 当 span id 为 a1 的元素被点击时，触发 AJAX 事件
		        $('#used-check').click(function() {
		            // 使用AJAX从后端以POST方式获取数据
		            $.ajax({
		                url: '/used/getAllSellerUsedListFragment', // 服务器端 API，返回 Thymeleaf 片段
		                type: 'POST',
		                success: function(response) {
		                    console.log("Fragment HTML:", response); // 打印返回的 HTML，便于调试

		                    // 使用 fragment 替换 <div class="use_1">
		                    $('.usedcheckarea').html(response);
		                    initializeSlick();
		                    
		                    // 检查并销毁已有 DataTables 实例
		                    if ($.fn.DataTable.isDataTable('#UsedList')) {
		                        $('#UsedList').DataTable().destroy();
		                    }

		                 // 初始化 DataTables
		                    var table = $('#UsedList').DataTable({
		                        "lengthMenu": [3, 5, 10, 20, 50, 100],
		                        "searching": true,
		                        "paging": true,
		                        "ordering": true,
		                        "language": {
		                            "processing": "處理中...",
		                            "loadingRecords": "載入中...",
		                            "lengthMenu": "顯示 _MENU_ 筆結果",
		                            "zeroRecords": "沒有符合的結果",
		                            "info": "顯示第 _START_ 至 _END_ 筆結果，共<font color=red> _TOTAL_ </font>筆",
		                            "infoEmpty": "顯示第 0 至 0 筆結果，共 0 筆",
		                            "infoFiltered": "(從 _MAX_ 筆結果中過濾)",
		                            "paginate": {
		                                "first": "第一頁",
		                                "previous": "上一頁",
		                                "next": "下一頁",
		                                "last": "最後一頁"
		                            }
		                        }
		                    });

		                    // 初始化 Slick 特效
		                    function initializeSlick() {
							    $('.photo-slider').not('.slick-initialized').slick({
							    	dots: false, // 禁用點狀導航
							        infinite: true, // 禁用無限滾動
							        speed: 300, // 滑動速度
							        slidesToShow: 1, // 每次只顯示一張圖片
							        slidesToScroll: 1, // 每次滑動一張圖片
							        adaptiveHeight: true, // 自適應高度
							        arrows: false, // 禁用 previous 和 next 按鈕
							        centerMode: false, // 禁用居中模式
							        variableWidth: false // 禁用可變寬度，讓所有圖片固定尺寸
							        
							    });
							    
							}


		                    // 初次载入时初始化 Slick
		                    initializeSlick();

		                    // 监听 DataTables 分页切换事件，重新初始化 Slick
		                    $('#UsedList').on('draw.dt', function () {
		                        initializeSlick();
		                    });
		                },
		                error: function(xhr, status, error) {
		                    console.error('Error fetching used list data:', error);
		                }
		            });
		        });
		    });

		    //====================二手商品刪除事件======================

		    document.addEventListener("DOMContentLoaded", function () {
		        // 初始化外部 DataTable
		        let dataTable;

		        // 动态绑定嵌入 DataTable 的删除按钮事件
		        document.body.addEventListener('click', function (event) {
		            if (event.target.classList.contains('deleteUsed')) {
		                const button = event.target;

		                // 获取绑定的商品编号 (usedNo)
		                const usedNo = button.getAttribute('data-usedNo');

		                // 确认删除操作
		                if (!confirm(`確定要刪除商品編號 ${usedNo} 嗎？`)) return;

		                // 发送删除请求
		                fetch(`/used/deleteUsed`, {
		                    method: 'POST',
		                    headers: {
		                        'Content-Type': 'application/json'
		                    },
		                    body: JSON.stringify({ usedNo: usedNo }) // 将 usedNo 发送到后端
		                })
		                    .then(response => response.json()) // 将响应解析为 JSON
		                    .then(data => {
		                        if (data.success) {
		                            alert(data.message); // 显示成功消息

		                            
		    						$('#used-check').click();// 重新觸發一次click事件取得 fragment
		                        } else {
		                            alert(`刪除失敗：${data.message}`);
		                        }
		                    })
		                    .catch(error => {
		                        console.error('刪除過程中發生錯誤:', error);
		                        alert('刪除過程中發生錯誤');
		                    });
		            }
		        });

		        // 当页面动态嵌入 DataTable 后，重新初始化 DataTable
		        function initializeDataTable() {
		            if (dataTable) {
		                dataTable.destroy(); // 如果 DataTable 已初始化，先销毁
		            }

		            // 重新初始化 DataTable
		            dataTable = $('#UsedList').DataTable({
		                paging: true,
		                searching: true,
		                ordering: true
		            });
		        }

		        // 假设触发嵌入 DataTable 的点击事件
		        document.getElementById('loadDataTableButton').addEventListener('click', function () {
		            // 模拟嵌入新表格（根据你的需求可能是 AJAX 或其他加载方式）
		            // 这里假设 DataTable 已嵌入 DOM 中

		            // 初始化新的 DataTable
		            initializeDataTable();
		        });
		    });

		</script>









</th:block>


<th:block th:fragment="js351">
	<!-- jQuery (Necessary for All JavaScript Plugins) -->
	<!-- <script src="https://code.jquery.com/jquery-3.5.1.js"></script> -->
	<!-- Popper js -->
	<script th:src="@{/back-end-home/js/popper.min.js}"></script>
	<!-- Bootstrap js -->
	<script th:src="@{/back-end-home/js/bootstrap.min.js}"></script>
	<!-- Plugins js -->
	<script th:src="@{/back-end-home/js/plugins.js}"></script>
	<!-- Active js -->
	<script th:src="@{/back-end-home/js/active.js}"></script>
</th:block>

